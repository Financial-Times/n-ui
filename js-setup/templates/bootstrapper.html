{{#if @root.flags.javascript}}
<script>
	window.nextFeatureFlags = {{{json @root.flagsArray}}};
	{{#if @root.nUiConfig}}
		window.ftNextUiConfig = {{{json @root.nUiConfig}}};
	{{/if}}
	{{#if anon}}window.nextIsAnonymous = {{anon.userIsAnonymous}};{{/if}}

	window.ftNextLoadScript = function (src) {
		var d = document, o = d.createElement('script');
		o.async = o.defer = true;
		o.src = src;
		var s = d.getElementsByTagName('script')[0];
		s.parentNode.insertBefore(o, s.nextSibling);
		return o;
	};

	window.ftNextFireCondition = function (condition) {
		var evName = 'ftNext' + condition;
		if (!window[evName]) {
			var ev = new CustomEvent(evName);
			document.dispatchEvent(ev);
			window[evName] = 1;
		}
	};

	{{>n-ui/layout/partials/css-loader}}

	var polyfillUrl = 'https://next-geebee.ft.com/polyfill/v2/polyfill.min.js';
	var polyfillCallbackName = 'ftNextPolyfillServiceCallback';

	window[polyfillCallbackName] = function () {
		window.ftNextFireCondition('PolyfillLoaded');
	};

	(function () {
		if (cutsTheMustard) {
			{{#if @root.javascriptBundles}}
				{{#each @root.javascriptBundles}}
					ftNextLoadScript('{{this}}');
				{{/each}}
			{{else}}
				{{!deprecated - logic for picking which javascripts to include now done in n-express}}
				{{#if @root.nUiVersion}} {{!note this only exists if the flag is on and the app has enabled n-ui bundle}}
					ftNextLoadScript('//next-geebee.ft.com/n-ui/no-cache/{{@root.nUiVersion}}/es5-core-js{{#unless @root.flags.nUiBundleUnminified}}.min{{/unless}}.js');
					ftNextLoadScript('{{#hashedAsset}}main-without-n-ui.js{{/hashedAsset}}');
				{{else}}
					ftNextLoadScript('{{#hashedAsset}}main.js{{/hashedAsset}}');
				{{/if}}
			{{/if}}

			ftNextLoadScript(polyfillUrl + '?callback=' + polyfillCallbackName + '{{#if @root.flags.polyfillsRUM}}&rum=1{{/if}}&features=' + [
				'default',
				'requestAnimationFrame',
				'Promise',
				'matchMedia',
				'HTMLPictureElement',
				// the following polyfills are included pending https://github.com/Financial-Times/polyfill-service/issues/653
				'CustomEvent|always|gated',
				'fetch|always|gated',
				'Array.prototype.find|always|gated',
				'Array.prototype.findIndex|always|gated',
				'IntersectionObserver'
			].join(',') + '&excludes=Symbol,Symbol.iterator,Symbol.species,Map,Set' + '&flags=gated&unknown=polyfill');
		} else {
			ftNextLoadScript(polyfillUrl + '?callback=' + polyfillCallbackName + '&features=' + [
				'default',
				'HTMLPictureElement|always|gated'
			].join(',') + '&flags=gated&unknown=polyfill');
		}
	})();
</script>
{{else}}
	<!-- always load the picturefill polyfill -->
	<script src="https://next-geebee.ft.com/polyfill/v2/polyfill.min.js?features=HTMLPictureElement|always|gated"></script>
{{/if}}
