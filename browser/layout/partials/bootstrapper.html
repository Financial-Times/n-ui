{{#if @root.flags.javascript}}
<script>
	{{>layout/partials/css-loader}}
	window.FT.flags = {{{json @root.flags}}};
	{{#if @root.nUiConfig}}
		window.FT.nUiConfig = {{{json @root.nUiConfig}}};
	{{/if}}
	{{#if anon}}window.FT.isAnonymous = {{anon.userIsAnonymous}};{{/if}}
	(function () {

		function loadError (err) {
			{{! If a script fails to load we'll get loads of errors which we can't prevent - not helpful to send them to sentry }}
			window.FT.disableOErrors = true;
			{{! log load failure to spoor }}
			var img = new Image();
			img.src = 'https://spoor-api.ft.com/px.gif?data=%7B%22category%22%3A%22javascript%22%2C%22action%22%3A%22load-error%22%2C%22system%22%3A%7B%22source%22%3A%22non-ctm%22%7D%2C%22user%22%3A%7B%7D%2C%22context%22%3A%7B%22product%22%3A%22next%22%2C%22script%22%3A%22' + encodeURIComponent(err.target.src) + '%22%7D%7D';
			throw new URIError('Failed to load ' + err.target.src + ': falling back to core experience.');
		};

		/**
		 * For Javascript bundles that have ES6 versions,
		 * load <script type="module"> for ES6 browsers and <script nomodule> for ES5 browsers.
		 *
		 * For Javascript bundles that don't have ES6 versions, just load ES5 <script>s.
		 */
		function loadScript(bundle) {
			var script = document.createElement('script');

			// For dynamically created scripts, this has the same effect as adding the 'defer' attribute to inline scripts;
			// that is, it tells it to load asynchronously and execute in order.
			script.async = false;

			if (bundle.stopsExecutionOnLoadError) {
				script.onerror = loadError;
			}
			if (bundle.fileEs6) {

				// Append the ES5 <script nomodule> version
				var nomoduleScript = script;
				nomoduleScript.noModule = true
				nomoduleScript.src = bundle.file;
				document.head.appendChild(nomoduleScript);

				// Set properties for the ES6 <script type="module"> version
				script.type = 'module';
				script.src = bundle.fileEs6;
			}
			else {

				// Set properties for the ES5 <script> version
				script.src = bundle.file;
			}
			document.head.appendChild(script);
		};

		if (cutsTheMustard) {
			{{#each @root.javascriptBundles}}
				loadScript({{{json this }}});
			{{/each}}
		} else {
			loadScript('{{{@root.polyfillIo.core}}}');
		}
	})()
</script>
{{else}}
	{{! always load the picturefill polyfill }}
	<script src="{{@root.polyfillIo.core}}"></script>
{{/if}}
