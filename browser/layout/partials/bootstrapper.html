{{#if @root.flags.javascript}}
<script>
	{{>layout/partials/css-loader}}
	window.FT.flags = {{{json @root.flags}}};
	{{#if @root.nUiConfig}}
		window.FT.nUiConfig = {{{json @root.nUiConfig}}};
	{{/if}}
	{{#if anon}}window.FT.isAnonymous = {{anon.userIsAnonymous}};{{/if}}

	(function () {
		const loadError = function (e) {
			window.FT.core = true;
			throw new URIError('Failed to load ' + e.target.src + ': falling back to core experience.');
		};

		const loadScript = function (src, isFatal) {
			if(!window.FT.core) {
				var d = document, o = d.createElement('script');
				{{! For dynamically created scripts this has the same effect as adding the defer
					attribute to inline scripts, i.e. load asynchronously, execute in order}}
				o.async = false;
				o.src = src;
				if(isFatal) {
					o.onerror = loadError;
				}
				var s = d.getElementsByTagName('script')[0];
				s.parentNode.insertBefore(o, s.nextSibling);
				return o;
			}
		};
		if (cutsTheMustard) {
			window.FT.core = false;
			{{#each @root.javascriptBundles}}
				loadScript('{{{this.file}}}', {{this.isFatal}});
			{{/each}}
		} else {
			loadScript('{{{@root.polyfillIo.core}}}');
		}
	})()
</script>
{{else}}
	{{! always load the picturefill polyfill }}
	<script src="{{@root.polyfillIo.core}}"></script>
{{/if}}
